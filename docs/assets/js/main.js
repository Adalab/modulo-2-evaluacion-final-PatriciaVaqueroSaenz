"use strict";console.log(">> Ready :)");const searchButton=document.querySelector(".js-searchButton"),resultList=document.querySelector(".js-main-list"),favoriteList=document.querySelector(".main__list-favorite");let showsName,showsImage,showsImageMedium,showId,globalData,favorites=[];const defaultImage="https://via.placeholder.com/210x295/ffffff/666666/?text=TV";function conectToApi(){const e=document.querySelector(".js-searchInput").value;fetch("//api.tvmaze.com/search/shows?q="+e).then(e=>e.json()).then(e=>{globalData=e,localStorage.setItem("globalData",JSON.stringify(e)),printShows(globalData)}),printFavoriteList(globalData)}function printShows(e){resultList.innerHTML="";for(let t=0;t<e.length;t++){showsName=e[t].show.name,showsImage=e[t].show.image,showId=e[t].show.id;let s="";s=void 0===favorites.find(e=>e===showId)?"":"favorite",null===showsImage?resultList.innerHTML+=`<li data-id="${showId}" class="js-list-item ${s}"><div class="js-list-div"><h2 class="js-showName">${showsName}</h2><img class= "js-image" src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV"/></div></li>`:(showsImageMedium=e[t].show.image.medium,resultList.innerHTML+=`<li data-id="${showId}" class="js-list-item ${s}"><div class="js-list-div"><h2 class="js-showName">${showsName}</h2><img class="js-image" src="${showsImageMedium}"/></div></li>`)}addListenerToCards()}function handleClik(){conectToApi()}if(searchButton.addEventListener("click",handleClik),null!==localStorage.getItem("favorites")){const e=JSON.parse(localStorage.getItem("favorites")),t=JSON.parse(localStorage.getItem("globalData"));for(const s of e){const e=t.find(e=>e.show.id===s);null===e.show.image?favoriteList.innerHTML+=`<li data-id="${e.show.id}" class="list-fav"><div class="div-fav"><h1 class="title-fav">${e.show.name}</h1><img class="img-fav" src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV"/><i data-id="${e.show.id}" class="fas fa-times-circle remove-fav"></i></div></li>`:favoriteList.innerHTML+=`<li data-id="${e.show.id}" class="list-fav"><div class="div-fav"><h1 class="title-fav">${e.show.name}</h1><img class="img-fav" src="${e.show.image.medium}"/><i data-id="${e.show.id}" class="fas fa-times-circle remove-fav"></i></div></li>`}addListenerToIcon()}const inputShow=document.querySelector(".js-searchInput");let filteredShows=[];function addListenerToCards(){const e=document.querySelectorAll(".js-list-item");for(const t of e)t.addEventListener("click",handleClickCard)}function handleClickCard(e){const t=e.currentTarget.dataset.id;void 0===favorites.find(e=>e===parseInt(t))?favorites.push(parseInt(t)):favorites=favorites.filter(e=>e!==parseInt(t)),localStorage.setItem("favorites",JSON.stringify(favorites)),printFavoriteList(e),renderFilteredShows()}function printFavoriteList(e){if(void 0!==e){const t=e.currentTarget.dataset.id,s=e.srcElement.innerText,a=e.srcElement.nextSibling.currentSrc;favoriteList.innerHTML+=`<li data-id="${t}" class="list-fav"><div class="div-fav"><h1 class="title-fav">${s}</h1><img class="img-fav" src="${a}"/><i data-id="${t}" class="fas fa-times-circle remove-fav"></i></div></li>`,console.log(favoriteList)}else favoriteList.innerHTML=""}function renderFilteredShows(){const e=inputShow.value.toLowerCase();for(const t of globalData)filteredShows=globalData.filter(t=>t.show.name.toLowerCase().includes(e));printShows(filteredShows)}function addListenerToIcon(){const e=document.querySelectorAll(".remove-fav");for(const t of e)t.addEventListener("click",handleClickRemoveFav)}function handleClickRemoveFav(e){console.log(e.target),console.log(e.target.dataset.id);e.target.parentNode.firstChild.innerText,e.target.parentNode.firstChild.nextSibling.currentSrc;let t=JSON.parse(localStorage.getItem("favorites"));JSON.parse(localStorage.getItem("globalData"));t=t.filter(t=>t!==parseInt(e.target.dataset.id)),localStorage.setItem("favorites",JSON.stringify(t))}function resetLS(){localStorage.clear(),favoriteList.innerHTML="",resultList.innerHTML="",location.reload()}const reset=document.querySelector(".section__fav-reset");reset.addEventListener("click",resetLS);